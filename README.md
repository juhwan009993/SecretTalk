# π“ Project: SecretTalk

### : Go E2E λ©”μ‹ μ €

## 1 ν”„λ΅μ νΈ κ°μ” (Overview)

- **κ°λ° κΈ°κ°„**: 2025-11-12 ~ 2025-11-14
- **ν•μ¤„ μ†κ°**: μ¤‘μ•™ μ„λ²„κ°€ λ©”μ‹μ§€ λ‚΄μ©μ„ μ λ€ λ³µνΈν™”ν•  μ μ—†λ” μ•μ „ν• 1:1 λ³΄μ• μ±„ν… μ‹μ¤ν…
- **κ°λ° λ™κΈ°**:
    - κΈ°μ΅΄ λ©”μ‹ μ €λ“¤μ μ¤‘μ•™ μ§‘μ¤‘ν• λ°μ΄ν„° μ €μ¥ λ°©μ‹μ— λ€ν• λ³΄μ• μ°λ ¤ ν•΄μ†
    - μ„λ²„λ¥Ό 'μ‹ λΆ°ν•  μ μ—†λ” μ—”ν‹°ν‹°(Untrusted Entity)'λ΅ κ°€μ •ν•κ³ , μ¤μ§ ν΄λΌμ΄μ–ΈνΈ λ‹¨μ—μ„λ§ λ°μ΄ν„°κ°€ ν‰λ¬ΈμΌλ΅ μ΅΄μ¬ν•λ” **Zero-Knowledge μ•„ν‚¤ν…μ²**λ¥Ό μ§μ ‘ κµ¬ν„ν•΄λ³΄κ³ μ ν•¨
    - μ¤λ‹ν•‘(Sniffing)μ— μ•μ „ν• ν”„λ΅ν† μ½μ„ μ„¤κ³„

### ν”„λ΅μ νΈ ν΄λ” κµ¬μ΅°

```text
SecretTalk/
β”β”€β”€ go.mod
β”β”€β”€ cmd/
β”‚   β”β”€β”€ server/
β”‚   β”‚   β””β”€β”€ main.go      # Zero-Knowledge μ¤‘κ³„ μ„λ²„
β”‚   β””β”€β”€ client/
β”‚       β””β”€β”€ main.go      # μ•”νΈν™” λ©”μ‹ μ € ν΄λΌμ΄μ–ΈνΈ
β””β”€β”€ pkg/
    β””β”€β”€ crypto/
        β””β”€β”€ crypto.go    # ECDH λ° AES-GCM ν•µμ‹¬ λ¨λ“

```

## 2 μ‚¬μ© κΈ°μ  (Tech Stack)

- **Language**: Go (Golang) - *λ™μ‹μ„± μ²λ¦¬(Goroutine) λ° λ©”λ¨λ¦¬ μ•μ „μ„± ν™μ©*
- **Network**: TCP Socket Programming (Custom Binary Protocol)
- **Cryptography**:
    - **Key Exchange**: ECDH (Elliptic Curve Diffie-Hellman, NIST P-256)
    - **Encryption**: AES-256-GCM (Galois/Counter Mode) - *κΈ°λ°€μ„± λ° λ¬΄κ²°μ„± λ™μ‹ λ³΄μ¥*
    - **RNG**: `crypto/rand` (Cryptographically Secure Pseudo-Random Number Generator)
- **Tools**: Wireshark (ν¨ν‚· λ¶„μ„ λ° λ³΄μ•μ„± κ²€μ¦)

## 3 ν•µμ‹¬ κΈ°λ¥ λ° λ³΄μ• μ„¤κ³„ (Key Features)

### 1. Zero-Knowledge Relay Architecture

- **μ„λ²„μ μ—­ν•  μµμ†ν™”**: μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈ Aμ™€ B μ‚¬μ΄μ—μ„ λ°”μ΄νΈ λ°°μ—΄(`[]byte`)μ„ μ „λ‹¬ν•λ” 'λ‹¨μ νμ΄ν”„(Relay)' μ—­ν• λ§ μν–‰
- **λ³µνΈν™” λ¶κ°€λ¥**: μ„λ²„ μ½”λ“ λ‚΄μ— λ³µνΈν™” λ΅μ§(Decrypt)μ΄ μ „λ¬΄ν•λ©°, ν‚¤ κµν™ κ³Όμ •μ—μ„λ„ κ°μΈν‚¤(Private Key)κ°€ λ„¤νΈμ›ν¬λ¥Ό νƒ€μ§€ μ•μΌλ―€λ΅ μ„λ²„ κ΄€λ¦¬μλ„ λ€ν™” λ‚΄μ©μ„ λ³Ό μ μ—†μ

### 2. μ•μ „ν• ν‚¤ κµν™ (ECDH Handshake)

- μ‚¬μ©μ μ ‘μ† μ‹ `crypto/ecdh` ν¨ν‚¤μ§€λ¥Ό μ΄μ©ν•΄ μΌνμ„± κ³µκ°ν‚¤ μμ„ μƒμ„±
- λ„¤νΈμ›ν¬μƒμΌλ΅λ” **κ³µκ°ν‚¤(Public Key)**λ§ μ „μ†΅λλ©°, κ° ν΄λΌμ΄μ–ΈνΈλ” μμ‹ μ κ°μΈν‚¤μ™€ μƒλ€μ κ³µκ°ν‚¤λ¥Ό μ΅°ν•©ν•΄ **κ³µμ  λΉ„λ°€ν‚¤(Shared Secret)**λ¥Ό λ΅μ»¬μ—μ„ μ λ„ν•¨

### 3. κ°•λ ¥ν• μ•”νΈν™” (AES-256-GCM)

- λ‹¨μ κΈ°λ°€μ„±(Confidentiality)λ§ μ κ³µν•λ” AES-CBC λ€μ‹ , λ°μ΄ν„° λ³€μ΅° μ—¬λ¶€(Integrity)κΉμ§€ κ²€μ¦ν•  μ μλ” **AES-GCM** λ¨λ“ μ±„νƒ
- λ©”μ‹μ§€ μ „μ†΅ μ‹λ§λ‹¤ κ³ μ ν• **Nonce**λ¥Ό μƒμ„±ν•μ—¬ μ•”νΈν™” κ°•λ„ ν™•λ³΄
- **λ©”νƒ€λ°μ΄ν„° λ³΄νΈ**: μ‚¬μ©μ λ‹‰λ„¤μ„κΉμ§€ νμ΄λ΅λ“μ— ν¬ν•¨ν•μ—¬ ν†µμ§Έλ΅ μ•”νΈν™”ν•¨μΌλ΅μ¨, κ³µκ²©μκ°€ "λ„κ°€ λ€ν™”ν•λ”μ§€"μ΅°μ°¨ μ‹λ³„ λ¶κ°€λ¥ν•κ² μ„¤κ³„

## 4. μ‹μ¤ν… μ•„ν‚¤ν…μ² (Architecture)
λ³Έ ν”„λ΅μ νΈμ ν•µμ‹¬ ν†µμ‹  νλ¦„μ€ μ•„λ μ‹ν€€μ¤ λ‹¤μ΄μ–΄κ·Έλ¨κ³Ό κ°™μ΄ λ™μ‘ν•©λ‹λ‹¤ μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈ κ°„μ λ©”μ‹μ§€λ¥Ό μ¤‘κ³„ν•λ” μ—­ν• λ§ μν–‰ν•λ©°, λ©”μ‹μ§€ λ‚΄μ©μ—λ” μ ‘κ·Όν•  μ μ—†μµλ‹λ‹¤

```mermaid
sequenceDiagram
    participant Alice
    participant Server (Relay)
    participant Bob

    Note over Alice, Bob: 1 ECDH Key Exchange (Insecure Channel)
    Alice->>Server: Send Public Key A (Plaintext)
    Server->>Bob: Forward Public Key A
    Bob->>Server: Send Public Key B (Plaintext)
    Server->>Alice: Forward Public Key B
    
    Note over Alice, Bob: 2 Derive Shared Secret (Local)
    Alice->>Alice: ECDH(PrivA, PubB) = SecretKey
    Bob->>Bob: ECDH(PrivB, PubA) = SecretKey

    Note over Alice, Bob: 3 Secure Messaging (Encrypted Channel)
    Alice->>Alice: AES-GCM-Encrypt("Hello", SecretKey)
    Alice->>Server: Send Ciphertext (Encrypted Blob)
    Server->>Bob: Relay Ciphertext
    Bob->>Bob: AES-GCM-Decrypt(Ciphertext, SecretKey)

```

**μƒμ„Έ μ„¤λ…:**
1. **ECDH ν‚¤ κµν™ (Insecure Channel)**:
    - Aliceμ™€ Bobμ€ κ°μ μƒμ„±ν• κ³µκ°ν‚¤(`PubA`, `PubB`)λ¥Ό μ„λ²„λ¥Ό ν†µν•΄ κµν™ν•©λ‹λ‹¤ μ΄ κ³Όμ •μ—μ„ κ³µκ°ν‚¤ μμ²΄λ” ν‰λ¬ΈμΌλ΅ μ „μ†΅λμ§€λ§, κ³µκ°ν‚¤λ§μΌλ΅λ” λΉ„λ°€ν‚¤(`PrivA`, `PrivB`)λ¥Ό μ μ¶”ν•  μ μ—†μµλ‹λ‹¤
2. **κ³µμ  λΉ„λ°€ν‚¤ μ λ„ (Local)**:
    - κ° ν΄λΌμ΄μ–ΈνΈλ” μμ‹ μ κ°μΈν‚¤(`PrivA` λλ” `PrivB`)μ™€ μƒλ€λ°©μ κ³µκ°ν‚¤(`PubB` λλ” `PubA`)λ¥Ό μ΄μ©ν•΄ λ΅μ»¬μ—μ„ λ™μΌν• **κ³µμ  λΉ„λ°€ν‚¤(`SecretKey`)**λ¥Ό λ…λ¦½μ μΌλ΅ μ λ„ν•©λ‹λ‹¤ μ΄ κ³µμ  λΉ„λ°€ν‚¤λ” λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ μ§μ ‘ μ „μ†΅λμ§€ μ•μΌλ―€λ΅ μ¤‘κ°„μ κ³µκ²©μ— μ•μ „ν•©λ‹λ‹¤
3. **μ•μ „ν• λ©”μ‹μ§• (Encrypted Channel)**:
    - ν΄λΌμ΄μ–ΈνΈλ” μ λ„λ κ³µμ  λΉ„λ°€ν‚¤(`SecretKey`)λ¥Ό μ‚¬μ©ν•μ—¬ λ©”μ‹μ§€λ¥Ό AES-GCM λ°©μ‹μΌλ΅ μ•”νΈν™”(`AES-GCM-Encrypt`)ν•©λ‹λ‹¤ μ•”νΈν™”λ λ©”μ‹μ§€(`Ciphertext`)λ” μ„λ²„λ¥Ό ν†µν•΄ μ „λ‹¬λλ©°, μ„λ²„λ” μ΄ μ•”νΈλ¬Έμ„ λ³µνΈν™”ν•  μ μ—†μµλ‹λ‹¤
    - μμ‹  ν΄λΌμ΄μ–ΈνΈλ” λ™μΌν• κ³µμ  λΉ„λ°€ν‚¤λ΅ μ•”νΈλ¬Έμ„ λ³µνΈν™”(`AES-GCM-Decrypt`)ν•μ—¬ μ›λ¬Έ λ©”μ‹μ§€λ¥Ό μ–»μµλ‹λ‹¤

## 5. κµ¬ν„ μƒμ„Έ (Implementation Details)

### μ»¤μ¤ν…€ ν”„λ΅ν† μ½ μ„¤κ³„

TCP μ¤νΈλ¦Ό μ„μ—μ„ ν¨μ¨μ μΈ λ°μ΄ν„° μ²λ¦¬λ¥Ό μ„ν•΄ λ°”μ΄λ„λ¦¬ ν¨ν‚· κµ¬μ΅°λ¥Ό μ§μ ‘ μ„¤κ³„

- **Type (1 Byte)**: ν¨ν‚· νƒ€μ… κµ¬λ¶„
    - `0x01`: κ³µκ°ν‚¤ κµν™μ© (PubKey)
    - `0x02`: μ•”νΈν™”λ λ©”μ‹μ§€ μ „μ†΅μ© (Message)
- **Payload (N Bytes)**: μ‹¤μ  μ „μ†΅ λ°μ΄ν„° (κ³µκ°ν‚¤ λ°”μ΄νΈ λλ” μ•”νΈν™”λ λ©”μ‹μ§€ λ³Έλ¬Έ)

### μ£Όμ” μ½”λ“ λ΅μ§ (Go)

- **μ•”νΈν™” μ—”μ§„**: `pkg/crypto` ν¨ν‚¤μ§€λ΅ λ¨λ“ν™”ν•μ—¬ μ¬μ‚¬μ©μ„± μ¦λ€
- **λ™μ‹μ„± μ²λ¦¬**: `cmd/server`μ—μ„ κ° ν΄λΌμ΄μ–ΈνΈ μ—°κ²°μ„ GoroutineμΌλ΅ μ²λ¦¬ν•μ—¬, λ‹¤μμ ν΄λΌμ΄μ–ΈνΈκ°€ λ™μ‹μ— λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›μ•„λ„ λΈ”λ΅ν‚Ή(Blocking) μ—†λ” ν†µμ‹  κµ¬ν„

## 6. κ²€μ¦ λ° μ„±κ³Ό (Verification & Results)

### Wiresharkλ¥Ό μ΄μ©ν• λ³΄μ•μ„± κ²€μ¦

λ΅μ»¬ λ£¨ν”„λ°±(`lo0`) μΈν„°νμ΄μ¤μ—μ„ ν¨ν‚·μ„ μΊ΅μ²ν•μ—¬ **κΈ°λ°€μ„±**κ³Ό **λ¦΄λ μ΄ μ•„ν‚¤ν…μ²**λ¥Ό μ§μ ‘ κ²€μ¦ν–μµλ‹λ‹¤

#### 1 μ „μ²΄ ν†µμ‹  νλ¦„ (Traffic Analysis)
![Packet Stream Overview](assets/wireshark_stream_overview.png)
- **Packet 9**: ν΄λΌμ΄μ–ΈνΈ(Sender) $\rightarrow$ μ„λ²„ (44 bytes μ „μ†΅)
- **Packet 11**: μ„λ²„ $\rightarrow$ μƒλ€λ°© ν΄λΌμ΄μ–ΈνΈ(Receiver) (44 bytes μ¤‘κ³„)
- μ„λ²„λ” λ°μ΄ν„°λ¥Ό μ²λ¦¬ν•κ±°λ‚ λ¨Έλ¬΄λ¥΄κ² ν•μ§€ μ•κ³ , μ¦‰μ‹ λ€μƒμ—κ² μ „λ‹¬(Relay)ν•λ” ν¨ν„΄μ„ λ³΄μ…λ‹λ‹¤

#### 2 νμ΄λ΅λ“ μ•”νΈν™” κ²€μ¦ (Payload Encryption)

**[Client $\rightarrow$ Server]**
![Encrypted Payload](assets/wireshark_client_send_encrypted.png)
- **Hex Dump**: `02 0c 15 69 ...`
- μ²« λ°”μ΄νΈ `0x02`λ” ν”„λ΅ν† μ½μƒ `TypeMsg`λ¥Ό μλ―Έν•©λ‹λ‹¤
- μ΄μ–΄μ§€λ” λ°μ΄ν„°λ” AES-256-GCMμΌλ΅ μ•”νΈν™”λμ–΄ μμ–΄, λ‹‰λ„¤μ„μ΄λ‚ λ©”μ‹μ§€ μ›λ¬Έμ„ μ „ν€ μ‹λ³„ν•  μ μ—†μµλ‹λ‹¤(Garbage Value)

**[Server $\rightarrow$ Peer]**
![Relayed Payload](assets/wireshark_server_relay_encrypted.png)
- μ„λ²„κ°€ μƒλ€λ°©μ—κ² μ „λ‹¬ν•λ” ν¨ν‚·μ λ°μ΄ν„°(`02 0c 15 69 ...`)κ°€ μ†΅μ‹ μμ ν¨ν‚·κ³Ό μ™„μ „ν λ™μΌν•©λ‹λ‹¤
- μ΄λ” μ„λ²„κ°€ μ¤‘κ°„μ—μ„ λ°μ΄ν„°λ¥Ό λ³€μ΅°ν•κ±°λ‚(Tampering) λ³µνΈν™”ν•μ§€ μ•κ³ , **ν¬λ…ν• νμ΄ν”„(Transparent Pipe)** μ—­ν• λ§ μν–‰ν•¨μ„ μ…μ¦ν•©λ‹λ‹¤

> **[κ²°λ΅ ]** μ¤‘κ°„μ(MITM)λ‚ μ•…μμ μΈ μ„λ²„ κ΄€λ¦¬μκ°€ ν¨ν‚·μ„ μ¤λ‹ν•‘ν•λ”λΌλ„, ECDHλ΅ ν•©μλ κ³µμ  λΉ„λ°€ν‚¤ μ—†μ΄λ” λ€ν™” λ‚΄μ©μ„ μ λ€ λ³µνΈν™”ν•  μ μ—†μµλ‹λ‹¤

## 7. μ‹¤ν–‰ λ°©λ²• (How to Run)

### μ‚¬μ „ μ¤€λΉ„

1. **Go μ„¤μΉ**: Go 1.21 μ΄μƒ λ²„μ „μ΄ μ‹μ¤ν…μ— μ„¤μΉλμ–΄ μμ–΄μ•Ό ν•©λ‹λ‹¤
2. **Go λ¨λ“ μ΄κΈ°ν™” λ° μμ΅΄μ„± λ‹¤μ΄λ΅λ“**: ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬μ—μ„ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•μ—¬ Go λ¨λ“μ„ μ΄κΈ°ν™”ν•κ³  ν•„μ”ν• μμ΅΄μ„±μ„ λ‹¤μ΄λ΅λ“ν•©λ‹λ‹¤
    ```bash
    go mod tidy
    ```

### μ‹¤ν–‰ λ‹¨κ³„

μ΄ μ„Έ κ°μ ν„°λ―Έλ„μ΄ ν•„μ”ν•©λ‹λ‹¤ κ° ν„°λ―Έλ„μ—μ„ ν”„λ΅μ νΈ λ£¨νΈ λ””λ ‰ν† λ¦¬(`SecretTalk/`)λ΅ μ΄λ™ν•μ—¬ λ‹¤μ λ…λ Ήμ–΄λ¥Ό μμ„λ€λ΅ μ‹¤ν–‰ν•©λ‹λ‹¤

#### 1. μ„λ²„ μ‹¤ν–‰ (Terminal 1)

```bash
go run cmd/server/main.go
```
- μ„λ²„κ°€ `localhost:9000`μ—μ„ ν΄λΌμ΄μ–ΈνΈ μ—°κ²°μ„ κΈ°λ‹¤λ¦½λ‹λ‹¤

#### 2. ν΄λΌμ΄μ–ΈνΈ A μ‹¤ν–‰ (Terminal 2)

μƒλ΅μ΄ ν„°λ―Έλ„ νƒ­ λλ” μ°½μ„ μ—΄κ³ , λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤

```bash
go run cmd/client/main.go
```
- λ‹‰λ„¤μ„μ„ μ…λ ¥ν•λΌλ” ν”„λ΅¬ν”„νΈκ°€ λ‚νƒ€λ‚λ©΄ μ›ν•λ” λ‹‰λ„¤μ„μ„ μ…λ ¥ν•©λ‹λ‹¤
- `Command> /connect`λ¥Ό μ…λ ¥ν•μ—¬ ν‚¤ κµν™μ„ μ‹μ‘ν•©λ‹λ‹¤

#### 3 ν΄λΌμ΄μ–ΈνΈ B μ‹¤ν–‰ (Terminal 3)

λ λ‹¤λ¥Έ ν„°λ―Έλ„ νƒ­ λλ” μ°½μ„ μ—΄κ³ , λ‹¤μ λ…λ Ήμ–΄λ¥Ό μ‹¤ν–‰ν•©λ‹λ‹¤

```bash
go run cmd/client/main.go
```
- λ§μ°¬κ°€μ§€λ΅ λ‹‰λ„¤μ„μ„ μ…λ ¥ν•κ³ , `Command> /connect`λ¥Ό μ…λ ¥ν•©λ‹λ‹¤

#### μ±„ν… μ‹μ‘

- λ‘ ν΄λΌμ΄μ–ΈνΈ λ¨λ‘ `/connect` λ…λ Ήμ„ μ…λ ¥ν•κ³  μƒλ€λ°©μ΄ μ ‘μ†ν•λ©΄ `[System] Secure Channel Established!` λ©”μ‹μ§€κ°€ λ‚νƒ€λ‚©λ‹λ‹¤
- μ΄μ  μ•μ „ν•κ² μ•”νΈν™”λ λ©”μ‹μ§€λ¥Ό μ£Όκ³ λ°›μ„ μ μμµλ‹λ‹¤
